---
title: "Anàlisi descriptiva"
author: "Segon Salmerón Èric (1672984)"
date: "2026-01-09"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Transformació de variables
```{r}
dades<- readRDS("dfcomplet.rds")
```

### Eliminació variables no informatives

\begin{enumerate}
  \item \textbf{proces:} Tipus de procés electoral (En aquest cas només hi ha eleccions generals codificades amb 02).
  \item \textbf{volta:} Prèn el mateix valor que `mes`
  \item \textbf{ccaa:} Comunitat autònoma de la secció censal (En aquest cas sempre és Catalunya, codificada amb 09).
  \item \textbf{municipi:} Conté el codi del municipi, però es una variable redundant ja que tenim una altra `codi_municipi` amb la mateixa infomració
\end{enumerate}

```{r}
dades <- subset(dades, select = -c(proces, volta, ccaa, municipi))
```


### Variable ´eleccio`

Com l'any 2019 hi van haver dues eleccions generals (a l'abril i al novembre), per referir-nos a cada elecció concreta hem d'usar una combinació de les variables `any`i `mes`.

```{r}
dades$eleccio <- paste0(
  dades$any, "_",
  ifelse(dades$mes == "04",  "abr",
  ifelse(dades$mes == "06",  "jun",
  ifelse(dades$mes == "07",  "jul",
  ifelse(dades$mes == "11", "nov",
  ifelse(dades$mes == "12", "des", NA)))))
)

#Fem que sigui un factor ordenat
nivells_eleccio <- unique(dades$eleccio[order(dades$any, dades$mes)])

dades$eleccio <- factor(dades$eleccio, levels = nivells_eleccio, ordered = TRUE)

```

### Correcció del tipus de variable

Correcció de variables que no són del tipus esperat

```{r}
dades <- dades %>%
  mutate(
    
    #Numèriques
    any = as.numeric(any), #Variable temporal
    mes = as.numeric(mes), #Variable temporal
    
    #Factors
    candidatura     = factor(candidatura),
    provincia        = factor(provincia),
    districte        = factor(districte),
    seccio           = factor(seccio),
    tipus            = factor(tipus),
    sigles           = factor(sigles),
    nom_partit       = factor(nom_partit),
    Municipi         = factor(Municipi),
    Codi_municipi    = factor(Codi_municipi),
    Districte        = factor(Districte),
  )

```


### Factorització de variables numèriques

De cara a la descripció de la base de dades i a la modelització és interessant tenir també una versió en factor de certes variables numèriques. Els punts de tall del factor vindran determinats pels tercils, quartils o quintils, en funció de en quants grups sigui adient segmentar en cada cas.


fac_Edad media, fac_Población, fac_Tamaño_medio_del_hogar, fac_renta_media_bruta_por_persona, fac_renta_media_bruta_por_hogar

#### Edat

```{r}
summary(dades[["Edad media de la población"]])

hist(
  dades[["Edad media de la población"]],
  main = "Edat mitjana de la població",
  xlab = "Edat mitjana (anys)",
  breaks = 30
)
```


Punts de tall establerts amb criteri social interpretatiu:

$\text{Mitjana edat} < 40 = \text{Secció jove}$

$40 < \text{Mitjana edat} < 45 = \text{Secció d'edat mitjana}$

$\text{Mitjana edat} > 45 = \text{Secció jove}$

```{r}
dades$fac_Edad_media <- cut(
  dades[["Edad media de la población"]],
  breaks = c(-Inf, 40, 45, Inf),
  labels = c("Secció jove", "Secció d'edat mitjana", "Secció envellida"),
  include.lowest = TRUE
)

plot(dades$fac_Edad_media)
```
#### Població


```{r}
summary(dades$Población)

hist(
dades$Población,
main = "Població per secció censal",
xlab = "Nombre d'habitants",
breaks = 30
)

```
Punts de talls establerts amb quartils:


```{r}
cuts_pob <- quantile(
dades$Población,
probs = c(0, 0.25, 0.5, 0.75, 1),
na.rm = TRUE
)

dades$fac_Población <- cut(
dades$Población,
breaks = cuts_pob,
include.lowest = TRUE,
labels = c(
"Població baixa",
"Població mitjana-baixa",
"Població mitjana-alta",
"Població alta"
)
)

cuts_pob


```

#### Mida mitjana de la llar
```{r}
summary(dades[["Tamaño medio del hogar"]])

hist(
dades[["Tamaño medio del hogar"]],
main = "Mida mitjana de la llar",
xlab = "Persones per llar",
breaks = 30
)

```

```{r}
cuts_hogar <- quantile(
dades[["Tamaño medio del hogar"]],
probs = c(0, 1/3, 2/3, 1),
na.rm = TRUE
)

dades$fac_Tamaño_medio_del_hogar <- cut(
dades[["Tamaño medio del hogar"]],
breaks = cuts_hogar,
include.lowest = TRUE,
labels = c(
"Llars petites",
"Llars mitjanes",
"Llars grans"
)
)

cuts_hogar

```
#### Renda bruta mitjana per persona

```{r}
summary(dades[["Renta bruta media por persona"]])

hist(
dades[["Renta bruta media por persona"]],
main = "Renda bruta mitjana per persona",
xlab = "Renda (€)",
breaks = 30
)

```
Punts de tall establerts amb quartils

```{r}
cuts_renda_persona <- quantile(
dades[["Renta bruta media por persona"]],
probs = seq(0,1,by=0.2),
na.rm = TRUE
)

dades$fac_renda_bruta_persona <- cut(
dades[["Renta bruta media por persona"]],
breaks = cuts_renda_persona,
include.lowest = TRUE,
labels = c(
"Renda molt baixa",
"Renda baixa",
"Renda mitjana",
"Renda alta",
"Renda molt alta"
)
)

cuts_renda_persona

```


#### Renda bruta mitjana per llar

```{r}
summary(dades[["Renta bruta media por hogar"]])

hist(
dades[["Renta bruta media por hogar"]],
main = "Renda bruta mitjana per llar",
xlab = "Renda (€)",
breaks = 30
)

```

Punts de talls establerts amb quartils

```{r}
cuts_renda_llar <- quantile(
dades[["Renta bruta media por hogar"]],
probs = seq(0,1,by=0.2),
na.rm = TRUE
)

dades$fac_renda_bruta_llar <- cut(
dades[["Renta bruta media por hogar"]],
breaks = cuts_renda_llar,
include.lowest = TRUE,
labels = c(
"Renda molt baixa",
"Renda baixa",
"Renda mitjana",
"Renda alta",
"Renda molt alta"
)
)

cuts_renda_llar
```



#### Mitjana de la renta per unitat de consum
```{r}
summary(dades[["Media de la renta por unidad de consumo"]])

hist(
dades[["Media de la renta por unidad de consumo"]],
main = "Renda mitjana per unitat de consum",
xlab = "Renda (€)",
breaks = 30
)

```
Punts de talls triats amb quintils

```{r}
cuts_renda_uc <- quantile(
dades[["Media de la renta por unidad de consumo"]],
probs = seq(0, 1, 0.2),
na.rm = TRUE
)

dades$fac_renda_media_uc <- cut(
dades[["Media de la renta por unidad de consumo"]],
breaks = cuts_renda_uc,
include.lowest = TRUE,
labels = c(
"Renda molt baixa",
"Renda baixa",
"Renda mitjana",
"Renda alta",
"Renda molt alta"
)
)

cuts_renda_uc
```

#### Mediana de la renta per unitat de consum

```{r}
summary(dades[["Mediana de la renta por unidad de consumo"]])

hist(
dades[["Mediana de la renta por unidad de consumo"]],
main = "Mediana de la renda per unitat de consum",
xlab = "Renda (€)",
breaks = 25
)

```

```{r}
cuts_mediana_uc <- quantile(
dades[["Mediana de la renta por unidad de consumo"]],
probs = seq(0, 1, 0.2),
na.rm = TRUE
)

dades$fac_renda_mediana_uc <- cut(
dades[["Mediana de la renta por unidad de consumo"]],
breaks = cuts_mediana_uc,
include.lowest = TRUE,
labels = c(
"Renda molt baixa",
"Renda baixa",
"Renda mitjana",
"Renda alta",
"Renda molt alta"
)
)

cuts_mediana_uc
```

