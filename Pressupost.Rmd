---
title: "Treball 5"
author: "Jordi Anguera"
date: "2025-12-16"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Pressupost

```{r,warning=FALSE,echo=FALSE,message=FALSE}
library(knitr)
library(kableExtra)
library(dplyr)

# Taula de pressupost
pressupost <- tibble(
  Fase = c(
    "1. Recerca prÃ¨via sobre el tema",
    "2. PreparaciÃ³ i integraciÃ³ de dades",
    "3. AnÃ lisi descriptiva i exploratÃ²ria",
    "4. ModelitzaciÃ³ estadÃ­stica primÃ ria",
    "5. ModelitzaciÃ³ estadÃ­stica secundÃ ria (avanÃ§ada)",
    "6. InterpretaciÃ³, visualitzaciÃ³ i validaciÃ³",
    "7. RedacciÃ³ de lâ€™informe i presentaciÃ³"
  ),
  Hores = c(12, 18, 25, 25, 20, 20, 20),
  Tarifa = c(90, 100, 120, 130, 150, 120, 120),
  Cost = c(1080, 1800, 3000, 3250, 3000, 2400, 2400)
) %>%
  mutate(
    `Hores dedicades` = paste0(Hores, " h"),
    `Tarifa aplicada` = paste0(Tarifa, " â‚¬ / h"),
    `Cost total` = paste0(format(Cost, big.mark = ".", decimal.mark = ","), " â‚¬")
  ) %>%
  select(
    Fase,
    `Hores dedicades`,
    `Tarifa aplicada`,
    `Cost total`
  )

# Afegir fila de totals
pressupost_final <- bind_rows(
  pressupost,
  tibble(
    Fase = "TOTAL PROJECTE",
    `Hores dedicades` = paste0(sum(c(12,18,25,25,20,20,20)), " h"),
    `Tarifa aplicada` = "",
    `Cost total` = paste0(
      format(sum(c(12,18,25,25,20,20,20) * c(90,100,120,130,150,120,120)),
             big.mark = ".", decimal.mark = ","),
      " â‚¬"
    )
  )
)
```

```{r,warning=FALSE,echo=FALSE,message=FALSE}
# Taula final
kable(
  pressupost_final,
  format = "latex",
  align = c("l", "c", "c", "c"),
  caption = "{Pressupost orientatiu del projecte (3â€“4 setmanes Â· equip de 4 estadÃ­stics)}",
) %>%
  kable_styling(
    latex_options = "hold_position",
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "center",
    font_size = 14
  ) %>%
  row_spec(0, bold = TRUE) %>%
  row_spec(nrow(pressupost_final), 
            bold = TRUE, 
            background = "#F2F2F2",
            extra_css = "border-top: 2px solid #999;")

```

```{r timeline_pro, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(stringr)
# Datos
fases <- tibble(
  fase = c(
    "Recerca prÃ¨via",
    "PreparaciÃ³ i integraciÃ³ de dades",
    "AnÃ lisi descriptiva i exploratÃ²ria",
    "ModelitzaciÃ³ estadÃ­stica primÃ ria",
    "ModelitzaciÃ³ estadÃ­stica secundÃ ria",
    "InterpretaciÃ³, visualitzaciÃ³ i validaciÃ³",
    "RedacciÃ³ de l'informe i presentaciÃ³"
  ),
  hores = c(12, 18, 25, 25, 20, 20, 20),
  tipus = c(
    "PlanificaciÃ³",
    "PlanificaciÃ³",
    "AnÃ lisi",
    "ModelitzaciÃ³",
    "ModelitzaciÃ³",
    "ValidaciÃ³",
    "ComunicaciÃ³"
  )
) %>%
  mutate(
    inici = cumsum(lag(hores, default = 0)),
    fi = inici + hores,
    fase_num_raw = paste0(row_number(), ". ", fase),
    fase_num = factor(
    str_wrap(fase_num_raw, width = 30),                 # ðŸ‘ˆ salto de lÃ­nea
    levels = rev(str_wrap(fase_num_raw, width = 30))
))

# Separadores de semanas (40 h por semana)
setmanes <- seq(40, 120, by = 40)

ggplot(fases) +
  # LÃ­neas de semanas
  geom_vline(xintercept = setmanes,
             linetype = "dashed",
             color = "grey70") +
  
  # Barras de fases
  geom_segment(aes(x = inici, xend = fi,
                   y = fase_num, yend = fase_num,
                   color = tipus),
               linewidth = 7,
               linecap = "round") +
  
  # Horas dentro
  geom_text(aes(x = (inici + fi)/2,
                y = fase_num,
                label = paste0(hores, " h")),
            color = "white",
            size = 4,
            fontface = "bold") +
  
  scale_color_manual(
    values = c(
      "PlanificaciÃ³" = "#1B9E77",
      "AnÃ lisi" = "#7570B3",
      "ModelitzaciÃ³" = "#D95F02",
      "ValidaciÃ³" = "#E7298A",
      "ComunicaciÃ³" = "#66A61E"
    )
  ) +
  
  scale_x_continuous(
    breaks = seq(0, 140, by = 20),
    expand = c(0, 0),
    name = "Hores acumulades del projecte"
  ) +
  
  labs(
    title = "PlanificaciÃ³ temporal del projecte",
    subtitle = "DistribuciÃ³ d'hores per fase (equip de 4 estadÃ­stics Â· 3â€“4 setmanes)",
    color = "Tipus de fase"
  ) +
  guides(
  color = guide_legend(nrow = 2, byrow = TRUE)
)+
  
  theme_minimal(base_size = 13) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    axis.title.y = element_blank(),
    legend.position = "bottom",
    plot.title = element_text(face = "bold"),
    plot.subtitle = element_text(color = "grey30")
  )

```

